<div class="shop-show-container">
  
  <%# --- 商品情報エリア --- %>
  <div class="shop-detail-header">
    <h1 class="shop-title"><%= @item.name %></h1>
    <p>価格: <%= @item.price %>円 / 容量: <%= @item.liter %>ml</p>
    <p>カテゴリー: <%= @item.category %> / 詳細: <%= @item.detail %></p>
    
    <% if @item.image.attached? %>
      <div class="shop-main-image">
        <%= image_tag @item.image, width: 300 %>
      </div>
    <% end %>
    
    <div style="display: inline-block; margin-left: 10px;">
      <% if current_user %>
        <%# すでにいいねしているかチェック %>
        <% if current_user.likes.exists?(item_id: @item.id) %>
          
          <%= link_to item_likes_path(@item), data: { turbo_method: :delete }, style: "text-decoration: none;" do %>
            <button style="border:1px solid #bbb; padding:8px 10px; background:#ffebeb; cursor:pointer;">
              いいね解除 ❤️　<%= @item.likes.count %>
            </button>
          <% end %>
        <% else %>
          <%= link_to item_likes_path(@item), data: { turbo_method: :post }, style: "text-decoration: none;" do %>
            <button style="border:1px solid #bbb; padding:8px 10px; background:#fff; cursor:pointer;">
              いいね 👍　<%= @item.likes.count %>
            </button>
          <% end %>
        <% end %>
      <% else %>
        
        <button style="border:1px solid #bbb; padding:8px 10px; background:#eee; color:#999;" disabled>
          いいね 👍　<%= @item.likes.count %>
        </button>
        
      <% end %>
    </div>
    
    <div style="margin-top: 10px;">
      <%= link_to "一覧に戻る", items_path(shop_id: @item.shop_id), class: "back-link" %>
    </div>
  </div>

  <hr class="divider">

  <%# --- レビュー投稿フォーム --- %>
  <div class="review-form-area">
    <h3>レビューを投稿する</h3>
    
    <% if session[:user_id] %>
      <%# item_reviews_path に自動的になります %>
      <%= form_with(model: [@item, @review], local: true, class: "review-form") do |f| %>
        
        <div class="form-group">
          <label>コメント</label>
          <%= f.text_area :content, rows: 3, placeholder: "商品の感想を書きましょう", class: "review-textarea" %>
        </div>

        <%= f.submit "投稿する", class: "submit-review-btn" %>
      <% end %>
    <% else %>
      <p style="color: #666;">レビューを投稿するには <%= link_to "ログイン", login_path %> してください。</p>
    <% end %>
  </div>

  <hr class="divider">

  <div class="reviews-list">
    <h3>みんなのレビュー (<%= @reviews.count %>件)</h3>

    <% if @reviews.any? %>
      <% @reviews.each do |review| %>
        <div class="review-card">
          <div class="review-header">
            <span class="review-user"><%= review.user.uid %> さん</span>
            <span class="review-date"><%= review.created_at.strftime('%Y/%m/%d') %></span>
          </div>
          <div class="review-body">
            <%= simple_format(review.content) %>
          </div>
        </div>
      <% end %>
    <% else %>
      <p>まだレビューはありません。</p>
    <% end %>
  </div>
</div>